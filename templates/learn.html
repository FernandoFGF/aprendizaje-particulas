{% extends "base.html" %}

{% block extra_css %}
<style>
    .drift-pane-container {
        overflow: hidden;
    }
    .drift-zoom-pane {
        width: 200px !important;
        height: 200px !important;
        border: 3px solid #fff;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        border-radius: 50% !important;
        background: white;
        object-fit: contain !important;
        background-size: contain !important;
        background-repeat: no-repeat !important;
    }
    .drift-bounding-box {
        background: rgba(255, 255, 255, 0.3);
        border: 2px dashed #fff;
        border-radius: 50%;
    }
    .image-zoom-container {
        border: 1px solid #ddd;
        margin-bottom: 20px;
        overflow: hidden;
        cursor: zoom-in;
    }
    .image-zoom-container img {
        transition: transform 0.3s;
        width: 100%;
    }
    .image-original-container {
        text-align: center;
        display: block;
        height: 100%;
    }
    .image-original-container img {
        margin: 0 auto;
        max-width: 100%;
        height: auto;
        display: block;
    }
    .characteristics-panel {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        border: 1px solid #dee2e6;
        height: 100%;
        transition: all 0.3s ease;
        overflow-y: auto;
    }
    .characteristic-item {
        background-color: white;
        border-radius: 8px;
        padding: 12px 15px;
        margin-bottom: 12px;
        border-left: 4px solid #1abc9c;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        min-height: auto;
        gap: 8px;
    }
    .characteristic-label {
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 0;
        font-size: 0.9em;
        flex: 0 0 35%;
        white-space: nowrap;
    }
    .characteristic-value {
        font-size: 0.95em;
        color: #1abc9c;
        font-weight: 600;
        text-align: right;
        flex: 0 0 65%;
        font-family: monospace;
        white-space: nowrap;
    }
    .btn-primary {
        background-color: #1abc9c !important;
        border-color: #1abc9c !important;
    }
    .btn-primary:hover {
        background-color: #16a085 !important;
        border-color: #16a085 !important;
    }
    .btn-primary:active,
    .btn-primary:focus,
    .btn-primary.active {
        background-color: #16a085 !important;
        border-color: #16a085 !important;
        box-shadow: 0 0 0 0.25rem rgba(26, 188, 156, 0.5) !important;
    }
    .btn-outline-primary {
        color: #1abc9c !important;
        border-color: #1abc9c !important;
    }
    .btn-outline-primary:hover {
        color: white !important;
        background-color: #1abc9c !important;
        border-color: #1abc9c !important;
    }
    .btn-outline-primary:active,
    .btn-outline-primary:focus,
    .btn-outline-primary.active {
        color: white !important;
        background-color: #16a085 !important;
        border-color: #16a085 !important;
        box-shadow: 0 0 0 0.25rem rgba(26, 188, 156, 0.5) !important;
    }
    .progress-bar {
        background-color: #1abc9c !important;
    }
    .no-images {
        padding: 2rem;
        text-align: center;
        font-size: 1.2rem;
        color: #6c757d;
    }
    .show-characteristics-btn {
        transition: all 0.3s ease;
        width: 100%;
        margin-bottom: 15px;
    }
    .characteristics-hidden {
        display: none;
    }
    .characteristics-visible {
        animation: fadeIn 0.5s ease-in;
        display: block;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateX(20px); }
        to { opacity: 1; transform: translateX(0); }
    }
    #learn-neutrino-energy,
    #learn-deposited-energy {
        color: #2c3e50;
        font-family: monospace;
        font-size: 0.95em;
    }
    .content-row {
        display: flex;
        align-items: stretch;
        min-height: 450px;
        gap: 20px;
        width: 100%;
        box-sizing: border-box;
    }
    .image-column {
        flex: 0 0 50%;
        max-width: 50%;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
    }
    .characteristics-column {
        flex: 0 0 50%;
        max-width: 50%;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
    }
    .characteristics-panel {
        background-color: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        border: 1px solid #dee2e6;
        height: 100%;
        transition: all 0.3s ease;
        overflow-y: auto;
        box-sizing: border-box;
        max-width: 100%;
    }
    .characteristics-panel h5 {
        margin-bottom: 1rem !important;
        font-weight: 600;
        color: #2c3e50;
    }
    .image-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: #f8f9fa;
        border-radius: 12px;
        padding: 15px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .characteristics-wrapper {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    .image-controls {
        margin-top: 15px;
        text-align: center;
    }
    .card-body {
        padding: 1.5rem;
        box-sizing: border-box;
        width: 100%;
    }
    .container, .container-fluid, .container-lg, .container-md, .container-sm, .container-xl, .container-xxl {
        box-sizing: border-box;
    }
    .card {
        box-sizing: border-box;
        width: 100%;
    }
    .card.mb-4 {
        margin-bottom: 1.5rem !important;
    }
    @media (max-width: 992px) {
        .content-row {
            flex-direction: column;
            min-height: auto;
        }
        .image-column,
        .characteristics-column {
            flex: 0 0 100%;
            max-width: 100%;
        }
        .image-column {
            margin-bottom: 20px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3">Aprender sobre Partículas</h1>
        <a href="{{ url_for('home') }}" class="btn btn-outline-primary">
            <i class="bi bi-house-fill me-2"></i>Volver al Inicio
        </a>
    </div>

    <!-- Progress bar -->
    <div class="progress mb-4">
        <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%"></div>
    </div>

    <!-- Content container -->
    <div id="content-wrapper">
        <div class="card mb-4">
            <div class="card-header bg-light">
                <h5 class="card-title mb-0">Partícula <span id="particle-number"></span> de <span id="total-particles"></span></h5>
            </div>
            <div class="card-body">
                <p class="card-text">Observa la siguiente imagen de partícula y haz clic en "Mostrar Características" para ver sus propiedades:</p>

                <!-- Main content row -->
                <div class="content-row">
                    <!-- Image column -->
                    <div class="image-column">
                        <div class="image-wrapper">
                            <!-- Image container -->
                            <div class="image-original-container mb-3 text-center" style="position: relative; flex: 1;">
                                {% if particles and particles|length > 0 %}
                                {% if SERVE_IMAGES_VIA_FLASK %}
                                <img src="{{ url_for('serve_external_image', subfolder='/learning', filename=particles[0].image_path) }}"
                                     data-zoom="{{ url_for('serve_external_image', subfolder='/learning', filename=particles[0].image_path) }}"
                                     alt="Imagen de partícula"
                                     class="img-fluid"
                                     id="zoom-image">
                                {% else %}
                                <img src="{{ BASE_URL }}/imagen_externa/learning/{{ particles[0].image_path }}"
                                     data-zoom="{{ BASE_URL }}/imagen_externa/learning/{{ particles[0].image_path }}"
                                     alt="Imagen de partícula"
                                     class="img-fluid"
                                     id="zoom-image">
                                {% endif %}
                                {% else %}
                                <div class="no-images">
                                    No hay partículas disponibles
                                </div>
                                {% endif %}

                                <!-- Container for the magnifying glass -->
                                <div class="drift-pane-container" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;">
                                    <div class="drift-pane rounded-circle" data-zoom-pane></div>
                                </div>
                            </div>

                            <!-- Show characteristics button -->
                            <div class="image-controls">
                                <button id="show-characteristics-btn" class="btn btn-primary show-characteristics-btn">
                                    <i class="bi bi-eye me-2"></i>Mostrar Características
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Characteristics column -->
                    <div class="characteristics-column">
                        <div class="characteristics-wrapper">
                            <!-- Characteristics panel -->
                            <div id="characteristics-panel" class="characteristics-panel characteristics-hidden">
                                <h5 class="mb-3"><i class="bi bi-info-circle me-2"></i>Características de la Partícula</h5>

                                <div class="characteristic-item">
                                    <div class="characteristic-label">Tipo de Interacción:</div>
                                    <div class="characteristic-value" id="interaction-type"></div>
                                </div>

                                <div class="characteristic-item">
                                    <div class="characteristic-label">Sabor:</div>
                                    <div class="characteristic-value" id="flavor"></div>
                                </div>

                                <div class="characteristic-item">
                                    <div class="characteristic-label">Modo de Interacción:</div>
                                    <div class="characteristic-value" id="interaction-mode"></div>
                                </div>

                                <div class="characteristic-item">
                                    <div class="characteristic-label">Trazas HI (Pesadas):</div>
                                    <div class="characteristic-value" id="heavy-ion-tracks">0</div>
                                </div>

                                <div class="characteristic-item">
                                    <div class="characteristic-label">Trazas LI (Ligeras):</div>
                                    <div class="characteristic-value" id="light-ion-tracks">0</div>
                                </div>

                                <div class="characteristic-item">
                                    <div class="characteristic-label">Cascadas Fotón:</div>
                                    <div class="characteristic-value" id="photon-showers">0</div>
                                </div>

                                <div class="characteristic-item">
                                    <div class="characteristic-label">Cascadas Electrón:</div>
                                    <div class="characteristic-value" id="electron-showers">0</div>
                                </div>

                                <div class="characteristic-item">
                                    <div class="characteristic-label">Energía neutrino:</div>
                                    <div class="characteristic-value" id="learn-neutrino-energy">0.000000 GeV</div>
                                </div>

                                <div class="characteristic-item">
                                    <div class="characteristic-label">Energía depositada:</div>
                                    <div class="characteristic-value" id="learn-deposited-energy">0.000000 GeV</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="d-flex justify-content-between">
        <button id="prev-btn" class="btn btn-outline-primary" disabled>
            <i class="bi bi-arrow-left me-2"></i>Anterior
        </button>
        <button id="next-btn" class="btn btn-primary">
            Siguiente<i class="bi bi-arrow-right ms-2"></i>
        </button>
    </div>
</div>

<!-- Hidden element to pass data to JavaScript -->
<script id="particles-data" type="application/json">{{ particles | tojson | safe }}</script>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/imageZoom.js') }}"></script>
<script src="{{ url_for('static', filename='js/learnNavigation.js') }}"></script>
{% endblock %}